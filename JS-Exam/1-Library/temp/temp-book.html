<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management - Books</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
            box-sizing: border-box;
        }
        
        body {
            height: 100vh;
            min-height: 100%;
            font-size: 1rem;
            font-family: sans-serif;
            background-color: #f7f7f7;
        }
        
        .title {
            margin: 20px;
        }
        
        .title-color {
            color: cadetblue;
        }
        
        /* Header */
        .header {
            width: 100%;
        }
        
        nav {
            width: 100%;
            display: flex;
            justify-content: left;
            align-items: center;
            height: 50px;
            background-color: black;
            padding-left: 20px;
        }
        
        a {
            text-decoration: none;
            color: white;
            padding-left: 20px;
            padding-right: 20px;
            border-right: 1px solid gray;
            border-left: 1px solid gray;
            font-size: 1.3rem;
            cursor: pointer;
        }
        
        a:hover {
            opacity: 0.8;
            text-decoration: underline cadetblue;
        }
        
        a.active {
            background-color: cadetblue;
        }
        
        .main-container {
            padding: 20px;
        }
        
        /* Main */
        .main-header {
            margin-bottom: 40px;
        }
        
        .main-header-top {
            display: grid;
            grid-template-columns: 1fr 0.1fr;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .main-header-bottom {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            margin-top: 1%;
        }
        
        .main-header-item-left {
            display: flex;
            align-items: center;
            justify-content: left;
            gap: 10px;
        }
        
        .main-header-item-right {
            display: flex;
            align-items: center;
            justify-content: right;
            gap: 10px;
        }
        
        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid black;
        }
        
        th, td {
            border: 1px solid black;
            padding: 5px;
            text-align: left;
        }
        
        th,
        td:nth-child(1),
        td:nth-child(5),
        td:nth-child(6),
        td:nth-child(7),
        td:nth-child(8) {
            text-align: center;
        }
        
        td:nth-child(2),
        td:nth-child(3),
        td:nth-child(4) {
            padding-left: 10px;
        }
        
        th:nth-child(1), td:nth-child(1) { width: 3.8%; }
        th:nth-child(2), td:nth-child(2) { width: 130px; }
        th:nth-child(3), td:nth-child(3) { width: 140px; }
        th:nth-child(4), td:nth-child(4) { width: 140px; }
        th:nth-child(5), td:nth-child(5) { width: 100px; }
        th:nth-child(6), td:nth-child(6) { width: 80px; }
        th:nth-child(7), td:nth-child(7) { width: 80px; }
        th:nth-child(8), td:nth-child(8) { width: 100px; }
        
        /* Pop-Ups */
        .pop-up {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .pop-up.hidden {
            display: none;
        }
        
        .pop-up-container {
            display: flex;
            flex-direction: column;
            width: 500px;
            background-color: white;
            padding: 20px;
            gap: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .pop-up-top {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .pop-up-bottom {
            margin-top: 10px;
            display: flex;
            justify-content: right;
            gap: 10px;
        }
        
        /* Stylings */
        .edit-buttons-style {
            border: none;
            background-color: transparent;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
        }
        
        .edit-buttons-style:hover {
            background-color: #f0f0f0;
        }
        
        .button-icons-style {
            width: 20px;
            height: 20px;
            margin: 2px;
        }
        
        .button-style {
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            font-size: 14px;
        }
        
        .button-style:hover {
            background-color: #f0f0f0;
        }
        
        .button-style.primary {
            background-color: cadetblue;
            color: white;
            border-color: cadetblue;
        }
        
        .button-style.primary:hover {
            background-color: #4a7c7e;
        }
        
        .input-style {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .select-style {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: red;
            font-size: 12px;
            margin-top: 2px;
        }
        
        .no-books {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        .sort-indicator {
            font-size: 12px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="title title-color">LIBRARY</h1>
            <nav class="nav-items">
                <a href="#" class="active" data-tab="books">Books</a>
                <a href="#" data-tab="visitors">Visitors</a>
                <a href="#" data-tab="cards">Cards</a>
                <a href="#" data-tab="statistics">Statistics</a>
            </nav>
        </header>

        <main>
            <div class="main-container">
                <div class="main-header">
                    <div class="main-header-top">
                        <h4 class="title-color">ALL BOOKS:</h4>
                        <button class="button-style primary" id="newBookBtn">New Book</button>
                    </div>
                    <hr>
                    <div class="main-header-bottom">
                        <div class="main-header-item-left">
                            <label for="sort">Sort by: </label>
                            <select class="select-style" name="sort" id="sortSelect">
                                <option value="id">ID</option>
                                <option value="name">Name</option>
                                <option value="author">Author</option>
                                <option value="publisher">Publisher</option>
                                <option value="publishYear">Publish Year</option>
                                <option value="pages">Pages</option>
                                <option value="copies">Copies</option>
                            </select>
                            <button class="button-style" id="sortBtn">Sort</button>
                        </div>
                        <div class="main-header-item-right">
                            <label for="searchInput">Search: </label>
                            <input class="input-style" type="text" id="searchInput" placeholder="Search books...">
                            <button class="button-style" id="searchBtn">Search</button>
                        </div>
                    </div>
                </div>

                <div class="main-body-container">
                    <table id="booksTable">
                        <thead>
                            <tr>
                                <th data-sort="no">No. <span class="sort-indicator"></span></th>
                                <th data-sort="name">Name <span class="sort-indicator"></span></th>
                                <th data-sort="author">Author <span class="sort-indicator"></span></th>
                                <th data-sort="publisher">Publisher <span class="sort-indicator"></span></th>
                                <th data-sort="publishYear">Publish <span class="sort-indicator"></span></th>
                                <th data-sort="pages">Pages <span class="sort-indicator"></span></th>
                                <th data-sort="copies">Copies <span class="sort-indicator"></span></th>
                                <th>Edit</th>
                            </tr>
                        </thead>
                        <tbody id="booksTableBody">
                            <tr class="no-books">
                                <td colspan="8">No books found. Click "New Book" to add your first book.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- Add Book Pop-up -->
        <div class="pop-up hidden" id="bookAddPopup">
            <div class="pop-up-container">
                <h1>New Book</h1>
                <form id="addBookForm">
                    <div class="pop-up-top">
                        <div>
                            <label for="addBookName">Book Name: </label>
                            <input class="input-style" name="name" id="addBookName" type="text" required>
                            <div class="error" id="addBookNameError"></div>
                        </div>
                        <div>
                            <label for="addAuthorName">Author: </label>
                            <input class="input-style" name="author" id="addAuthorName" type="text" required>
                            <div class="error" id="addAuthorNameError"></div>
                        </div>
                        <div>
                            <label for="addPublisherName">Publisher: </label>
                            <input class="input-style" name="publisher" id="addPublisherName" type="text" required>
                            <div class="error" id="addPublisherNameError"></div>
                        </div>
                        <div>
                            <label for="addPublishYear">Publish Year: </label>
                            <input class="input-style" name="publishYear" id="addPublishYear" type="number" min="1" max="2025" required>
                            <div class="error" id="addPublishYearError"></div>
                        </div>
                        <div>
                            <label for="addPages">Pages: </label>
                            <input class="input-style" name="pages" id="addPages" type="number" min="1" required>
                            <div class="error" id="addPagesError"></div>
                        </div>
                        <div>
                            <label for="addCopies">Copies: </label>
                            <input class="input-style" name="copies" id="addCopies" type="number" min="1" required>
                            <div class="error" id="addCopiesError"></div>
                        </div>
                    </div>
                    <div class="pop-up-bottom">
                        <button type="button" class="button-style" id="cancelAddBtn">Cancel</button>
                        <button type="submit" class="button-style primary">Create</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Book Pop-up -->
        <div class="pop-up hidden" id="bookEditPopup">
            <div class="pop-up-container">
                <h1>Edit Book</h1>
                <form id="editBookForm">
                    <div class="pop-up-top">
                        <div>
                            <label for="editBookName">Book Name: </label>
                            <input class="input-style" name="name" id="editBookName" type="text" required>
                            <div class="error" id="editBookNameError"></div>
                        </div>
                        <div>
                            <label for="editAuthorName">Author: </label>
                            <input class="input-style" name="author" id="editAuthorName" type="text" required>
                            <div class="error" id="editAuthorNameError"></div>
                        </div>
                        <div>
                            <label for="editPublisherName">Publisher: </label>
                            <input class="input-style" name="publisher" id="editPublisherName" type="text" required>
                            <div class="error" id="editPublisherNameError"></div>
                        </div>
                        <div>
                            <label for="editPublishYear">Publish Year: </label>
                            <input class="input-style" name="publishYear" id="editPublishYear" type="number" min="1" max="2025" required>
                            <div class="error" id="editPublishYearError"></div>
                        </div>
                        <div>
                            <label for="editPages">Pages: </label>
                            <input class="input-style" name="pages" id="editPages" type="number" min="1" required>
                            <div class="error" id="editPagesError"></div>
                        </div>
                        <div>
                            <label for="editCopies">Copies: </label>
                            <input class="input-style" name="copies" id="editCopies" type="number" min="1" required>
                            <div class="error" id="editCopiesError"></div>
                        </div>
                    </div>
                    <div class="pop-up-bottom">
                        <button type="button" class="button-style" id="cancelEditBtn">Cancel</button>
                        <button type="submit" class="button-style primary">Confirm</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

<script>
    // Book Class
    class Book {
        #id;
        #name;
        #authorName;
        #publishYear;
        #publisherName;
        #pages;
        #copies;

        constructor() {
            this.#id = 0;
            this.#name = "";
            this.#authorName = "";
            this.#publishYear = new Date().getFullYear();
            this.#publisherName = "";
            this.#pages = 0;
            this.#copies = 0;
        }

        get Id() { return this.#id; }
        get Name() { return this.#name; }
        get AuthorName() { return this.#authorName; }
        get PublishYear() { return this.#publishYear; }
        get PublisherName() { return this.#publisherName; }
        get Pages() { return this.#pages; }
        get Copies() { return this.#copies; }

        set Id(value) { this.#id = value; }
        set Name(value) { this.#name = value; }
        set AuthorName(value) { this.#authorName = value; }
        set PublishYear(value) { this.#publishYear = value; }
        set PublisherName(value) { this.#publisherName = value; }
        set Pages(value) { this.#pages = value; }
        set Copies(value) { this.#copies = value; }

        toJSON() {
            return {
                id: this.#id,
                name: this.#name,
                authorName: this.#authorName,
                publishYear: this.#publishYear,
                publisherName: this.#publisherName,
                pages: this.#pages,
                copies: this.#copies
            };
        }

        static fromJSON(data) {
            const book = new Book();
            book.Id = data.id;
            book.Name = data.name;
            book.AuthorName = data.authorName;
            book.PublishYear = data.publishYear;
            book.PublisherName = data.publisherName;
            book.Pages = data.pages;
            book.Copies = data.copies;
            return book;
        }
    }

    class LibraryManager {
        constructor() {
            this.books = [];
            this.currentSort = { field: 'no', direction: 'asc' };
            this.currentEditId = null;
            this.initializeEventListeners();
            this.loadData();  // Load from localStorage or use sample
            this.renderBooks();
        }

        loadData() {
            const storedBooks = localStorage.getItem('books');
            if (storedBooks) {
                const parsed = JSON.parse(storedBooks);
                this.books = parsed.map(data => Book.fromJSON(data));
            } else {
                this.loadSampleData();
                this.saveToLocalStorage();
            }
        }

        saveToLocalStorage() {
            const json = this.books.map(book => book.toJSON());
            localStorage.setItem('books', JSON.stringify(json));
        }

        loadSampleData() {
            const sampleBooks = [
                { name: "To Kill a Mockingbird", author: "Harper Lee", publisher: "J.B. Lippincott & Co.", publishYear: 1960, pages: 281, copies: 5 },
                { name: "1984", author: "George Orwell", publisher: "Secker & Warburg", publishYear: 1949, pages: 328, copies: 3 },
                { name: "Pride and Prejudice", author: "Jane Austen", publisher: "T. Egerton", publishYear: 1813, pages: 432, copies: 4 }
            ];
            sampleBooks.forEach(data => {
                const book = new Book();
                book.Id = this.generateUniqueId();
                book.Name = data.name;
                book.AuthorName = data.author;
                book.PublisherName = data.publisher;
                book.PublishYear = data.publishYear;
                book.Pages = data.pages;
                book.Copies = data.copies;
                this.books.push(book);
            });
        }

        generateUniqueId() {
            return Date.now() + Math.floor(Math.random() * 1000);
        }

        initializeEventListeners() {
            document.getElementById('newBookBtn').addEventListener('click', () => this.showAddBookPopup());
            document.getElementById('sortBtn').addEventListener('click', () => this.sortBooks());
            document.querySelectorAll('th[data-sort]').forEach(th =>
                th.addEventListener('click', () => this.sortByField(th.dataset.sort))
            );
            document.getElementById('searchInput').addEventListener('input', e =>
                this.searchBooks(e.target.value)
            );
            document.getElementById('searchBtn').addEventListener('click', () => {
                const term = document.getElementById('searchInput').value;
                this.searchBooks(term);
            });

            document.getElementById('addBookForm').addEventListener('submit', e => {
                e.preventDefault();
                this.addBook();
            });

            document.getElementById('cancelAddBtn').addEventListener('click', () => this.hideAddBookPopup());
            document.getElementById('editBookForm').addEventListener('submit', e => {
                e.preventDefault();
                this.updateBook();
            });

            document.getElementById('cancelEditBtn').addEventListener('click', () => this.hideEditBookPopup());

            document.getElementById('bookAddPopup').addEventListener('click', e => {
                if (e.target.id === 'bookAddPopup') this.hideAddBookPopup();
            });

            document.getElementById('bookEditPopup').addEventListener('click', e => {
                if (e.target.id === 'bookEditPopup') this.hideEditBookPopup();
            });
        }

        addBook() {
            if (!this.validateBookForm('add')) return;
            const formData = new FormData(document.getElementById('addBookForm'));
            const book = new Book();

            book.Id = this.generateUniqueId();
            book.Name = formData.get('name').trim();
            book.AuthorName = formData.get('author').trim();
            book.PublisherName = formData.get('publisher').trim();
            book.PublishYear = parseInt(formData.get('publishYear'));
            book.Pages = parseInt(formData.get('pages'));
            book.Copies = parseInt(formData.get('copies'));

            this.books.push(book);
            this.saveToLocalStorage(); // Save
            this.renderBooks();
            this.hideAddBookPopup();
            this.resetForm('addBookForm');
        }

        updateBook() {
            if (!this.validateBookForm('edit')) return;
            const formData = new FormData(document.getElementById('editBookForm'));
            const index = this.books.findIndex(book => book.Id === this.currentEditId);
            if (index !== -1) {
                const book = this.books[index];
                book.Name = formData.get('name').trim();
                book.AuthorName = formData.get('author').trim();
                book.PublisherName = formData.get('publisher').trim();
                book.PublishYear = parseInt(formData.get('publishYear'));
                book.Pages = parseInt(formData.get('pages'));
                book.Copies = parseInt(formData.get('copies'));

                this.saveToLocalStorage(); // Save
                this.renderBooks();
                this.hideEditBookPopup();
            }
        }

        deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                this.books = this.books.filter(book => book.Id !== id);
                this.saveToLocalStorage(); // Save
                this.renderBooks();
            }
        }

        validateBookForm(type) {
            const prefix = type === 'add' ? 'add' : 'edit';
            let isValid = true;
            const form = document.getElementById(`${prefix}BookForm`);
            form.querySelectorAll('.error').forEach(e => e.textContent = '');

            const fields = ['BookName', 'AuthorName', 'PublisherName', 'PublishYear', 'Pages', 'Copies'];
            fields.forEach(field => {
                const input = document.getElementById(`${prefix}${field}`);
                const errorDiv = document.getElementById(`${prefix}${field}Error`);
                if (!input.value.trim()) {
                    errorDiv.textContent = 'This field is required';
                    isValid = false;
                } else if (['Pages', 'Copies'].includes(field) && parseInt(input.value) < 1) {
                    errorDiv.textContent = 'Value must be positive';
                    isValid = false;
                } else if (field === 'PublishYear') {
                    const year = parseInt(input.value);
                    if (year < 1 || year > 2025) {
                        errorDiv.textContent = 'Year must be between 1 and 2025';
                        isValid = false;
                    }
                }
            });
            return isValid;
        }

        sortBooks() {
            const sortField = document.getElementById('sortSelect').value;
            this.sortByField(sortField);
        }

        sortByField(field) {
            const direction = this.currentSort.field === field && this.currentSort.direction === 'asc' ? 'desc' : 'asc';
            const fieldMap = {
                id: 'Id',
                name: 'Name',
                author: 'AuthorName',
                publisher: 'PublisherName',
                publishYear: 'PublishYear',
                pages: 'Pages',
                copies: 'Copies',
                no: null
            };

            const key = fieldMap[field];
            this.books.sort((a, b) => {
                const aVal = key ? a[key] : this.books.indexOf(a) + 1;
                const bVal = key ? b[key] : this.books.indexOf(b) + 1;
                return direction === 'asc'
                    ? (aVal > bVal ? 1 : -1)
                    : (aVal < bVal ? 1 : -1);
            });

            this.currentSort = { field, direction };
            this.updateSortIndicators();
            this.renderBooks();
        }

        updateSortIndicators() {
            document.querySelectorAll('.sort-indicator').forEach(el => el.textContent = '');
            const header = document.querySelector(`th[data-sort="${this.currentSort.field}"] .sort-indicator`);
            if (header) header.textContent = this.currentSort.direction === 'asc' ? '↑' : '↓';
        }

        searchBooks(term) {
            const lower = term.toLowerCase();
            const filtered = this.books.filter(book =>
                book.Name.toLowerCase().includes(lower) ||
                book.AuthorName.toLowerCase().includes(lower) ||
                book.PublisherName.toLowerCase().includes(lower)
            );
            this.renderFilteredBooks(filtered);
        }

        renderBooks() {
            this.renderFilteredBooks(this.books);
        }

        renderFilteredBooks(books) {
            const tbody = document.getElementById('booksTableBody');
            if (books.length === 0) {
                tbody.innerHTML = '<tr class="no-books"><td colspan="8">No books found.</td></tr>';
                return;
            }
            tbody.innerHTML = books.map((book, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${book.Name}</td>
                    <td>${book.AuthorName}</td>
                    <td>${book.PublisherName}</td>
                    <td>${book.PublishYear}</td>
                    <td>${book.Pages}</td>
                    <td>${book.Copies}</td>
                    <td>
                        <button class="edit-buttons-style" onclick="libraryManager.showEditBookPopup(${book.Id})">✏️</button>
                        <button class="edit-buttons-style" onclick="libraryManager.deleteBook(${book.Id})">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        showAddBookPopup() {
            document.getElementById('bookAddPopup').classList.remove('hidden');
            document.getElementById('addBookName').focus();
        }

        hideAddBookPopup() {
            document.getElementById('bookAddPopup').classList.add('hidden');
            this.resetForm('addBookForm');
        }

        showEditBookPopup(id) {
            const book = this.books.find(b => b.Id === id);
            if (!book) return;
            this.currentEditId = id;
            document.getElementById('editBookName').value = book.Name;
            document.getElementById('editAuthorName').value = book.AuthorName;
            document.getElementById('editPublisherName').value = book.PublisherName;
            document.getElementById('editPublishYear').value = book.PublishYear;
            document.getElementById('editPages').value = book.Pages;
            document.getElementById('editCopies').value = book.Copies;
            document.getElementById('bookEditPopup').classList.remove('hidden');
        }

        hideEditBookPopup() {
            document.getElementById('bookEditPopup').classList.add('hidden');
            this.resetForm('editBookForm');
            this.currentEditId = null;
        }

        resetForm(formId) {
            const form = document.getElementById(formId);
            form.reset();
            form.querySelectorAll('.error').forEach(e => e.textContent = '');
        }
    }

    const libraryManager = new LibraryManager();
</script>

</body>
</html>
